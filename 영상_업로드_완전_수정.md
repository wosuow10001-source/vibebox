# 영상 업로드 문제 완전 해결

## 발견된 문제들

### 1. 파일 크기 제한 (가장 심각)
- **문제**: 모든 영상이 정확히 10MB (10,485,760 bytes)로 잘림
- **원인**: Next.js 15 API 라우트의 기본 바디 크기 제한
- **영향**: 42MB 영상이 10MB로 잘려서 재생 불가

### 2. contents.json 데이터 문제
- **문제**: 중복 slug (`sample-content`), asset- ID가 별도 콘텐츠로 등록됨
- **영향**: 메인 페이지에서 혼란, 중복 표시

### 3. 청크 업로드 미작동
- **문제**: 기존 청크 업로드 코드가 실제로 작동하지 않음
- **원인**: FormData 크기 제한, API 라우트 설정 부족

## 해결 방법

### ✅ 1. 청크 업로드 API 완성
**파일**: `app/api/admin/assets/upload-chunk/route.ts`
- 5MB 청크로 파일 분할 업로드
- 임시 파일에 청크 누적
- 마지막 청크 수신 시 최종 파일 생성
- `maxDuration`, `dynamic` 설정 추가

### ✅ 2. 직접 업로드 페이지 생성
**파일**: `app/admin/upload-direct/page.tsx`
- 간단한 UI로 영상 파일 선택
- 자동 청크 업로드 (5MB씩)
- 실시간 진행률 표시
- 업로드 완료 후 자동 리다이렉트

### ✅ 3. contents.json 정리
- 중복 slug 제거 (`satan`, `satan2`로 분리)
- asset- ID 중복 제거
- 깔끔한 데이터 구조

### ✅ 4. 메인 페이지 필터링 제거
**파일**: `app/(public)/page.tsx`
- asset- ID 필터링 제거
- 모든 콘텐츠 정상 표시

### ✅ 5. 관리자 대시보드 업데이트
**파일**: `app/admin/page.tsx`
- "🎬 영상 업로드" 카드 추가
- `/admin/upload-direct` 링크

## 사용 방법

### 방법 1: 직접 영상 업로드 (권장)
1. 관리자 페이지 접속: `http://localhost:3000/admin`
2. "🎬 영상 업로드" 카드 클릭
3. 영상 파일 선택 (최대 2GB)
4. 자동 업로드 진행 (5MB 청크)
5. 완료 후 메인 페이지에서 확인

### 방법 2: 기존 업로드 페이지
1. 관리자 페이지 → "📥 파일 업로드"
2. 영상 선택 (10MB 이상은 자동 청크 업로드)
3. 콘텐츠 생성 페이지로 이동

## 테스트 방법

### 1. 개발 서버 재시작
```bash
npm run dev
```

### 2. 42MB 영상 업로드
- 파일: `korea_hiphop_ai_musicvedio_satan1.mp4`
- 경로: `/admin/upload-direct`

### 3. 파일 크기 확인
```bash
# PowerShell
Get-ChildItem "public\uploads\asset-*\index.mp4" | Select-Object Name, Length

# 42MB (44,040,192 bytes) 확인
```

### 4. 메인 페이지 확인
- URL: `http://localhost:3000`
- 영상 썸네일 표시 확인
- 재생 버튼 아이콘 확인

### 5. 상세 페이지 확인
- 영상 클릭
- URL: `http://localhost:3000/a/[slug]`
- 영상 플레이어 정상 작동 확인

## 수정된 파일 목록

1. ✅ `app/api/admin/assets/upload-chunk/route.ts` (신규)
2. ✅ `app/admin/upload-direct/page.tsx` (신규)
3. ✅ `app/admin/page.tsx` (영상 업로드 카드 추가)
4. ✅ `app/(public)/page.tsx` (필터링 제거)
5. ✅ `data/contents.json` (중복 제거, slug 수정)
6. ✅ `next.config.ts` (bodySizeLimit 2GB)
7. ✅ `app/admin/upload/page.tsx` (청크 업로드 로직)

## 예상 결과

### 업로드 전
```
파일: korea_hiphop_ai_musicvedio_satan1.mp4
크기: 42.1 MB (44,040,192 bytes)
```

### 업로드 후
```
위치: public/uploads/asset-[UUID]/index.mp4
크기: 42.1 MB (44,040,192 bytes) ✅
상태: 완전한 파일, 재생 가능
```

### 메인 페이지
```
✅ 영상 썸네일 표시
✅ 재생 버튼 아이콘
✅ 제목 표시
```

### 상세 페이지
```
✅ 영상 플레이어 표시
✅ 재생 컨트롤 작동
✅ 전체 영상 재생 가능
```

## 문제 해결 체크리스트

- [x] 파일 크기 제한 해결 (청크 업로드)
- [x] contents.json 정리 (중복 제거)
- [x] 메인 페이지 표시 수정
- [x] 직접 업로드 페이지 생성
- [x] 관리자 대시보드 업데이트
- [x] 테스트 스크립트 작성
- [ ] 42MB 영상 실제 업로드 테스트 (사용자가 수행)
- [ ] 메인 페이지 확인 (사용자가 수행)
- [ ] 영상 재생 확인 (사용자가 수행)

## 다음 단계

1. **개발 서버 재시작**: `npm run dev`
2. **직접 업로드 페이지 접속**: `http://localhost:3000/admin/upload-direct`
3. **42MB 영상 업로드**: `korea_hiphop_ai_musicvedio_satan1.mp4`
4. **메인 페이지 확인**: `http://localhost:3000`
5. **영상 재생 테스트**: 썸네일 클릭 → 상세 페이지 → 재생

## 주의사항

- 청크 업로드는 5MB씩 진행되므로 42MB 파일은 약 9개 청크
- 업로드 중 페이지를 닫지 마세요
- 네트워크 속도에 따라 1-5분 소요
- 업로드 완료 후 자동으로 메인 페이지로 이동
