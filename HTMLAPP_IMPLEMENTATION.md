# ğŸŒ HTML ì•± ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ë¬¸ì„œ

## ğŸ“‹ ê°œìš”

ê´€ë¦¬ìê°€ HTML íŒŒì¼(CSS+JS í¬í•¨)ì„ ì—…ë¡œë“œí•˜ë©´, ë©”ì¸ í˜ì´ì§€ì—ì„œ iframeì„ í†µí•´ ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë©”ì¸ í˜ì´ì§€ (/)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  iframe (sandbox="allow-scripts ...") âœ…    â”‚  â”‚
â”‚  â”‚  - htmlContentë¥¼ srcDocì— ë¡œë“œ              â”‚  â”‚
â”‚  â”‚  - ë¶€ëª¨ í˜ì´ì§€ ì¿ í‚¤/ìŠ¤í† ë¦¬ì§€ ì ‘ê·¼ ë¶ˆê°€    â”‚  â”‚
â”‚  â”‚  - CSS+JS ëª¨ë‘ í¬í•¨ ë™ì‘                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ GET /api/apps/current
         â”‚ (appId, name, publicUrl, htmlContent)
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë°±ì—”ë“œ API                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ POST /api/admin/upload-html                  â”‚  â”‚
â”‚  â”‚ - auth í™•ì¸ (JWT Token)                      â”‚  â”‚
â”‚  â”‚ - HTML íŒŒì¼ ì €ì¥ (Prisma)                   â”‚  â”‚
â”‚  â”‚ - Return: { appId, publicUrl }              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ POST /api/admin/apps/activate                â”‚  â”‚
â”‚  â”‚ - auth í™•ì¸ (JWT Token)                      â”‚  â”‚
â”‚  â”‚ - appIdë¥¼ í™œì„±í™” (isActive=true)           â”‚  â”‚
â”‚  â”‚ - ê¸°ì¡´ í™œì„± ì•± ë¹„í™œì„±í™”                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET /api/apps/current                       â”‚  â”‚
â”‚  â”‚ - í™œì„±í™”ëœ ì•± ì •ë³´ ì¡°íšŒ (htmlContent í¬í•¨) â”‚  â”‚
â”‚  â”‚ - í™œì„±ì•± ì—†ìœ¼ë©´: 404                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GET /api/admin/apps/list                    â”‚  â”‚
â”‚  â”‚ - auth í™•ì¸ (JWT Token)                      â”‚  â”‚
â”‚  â”‚ - ëª¨ë“  ì—…ë¡œë“œëœ ì•± ëª©ë¡ ì¡°íšŒ                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ FormData (multipart/form-data)
         â”‚ file: HTML
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ê´€ë¦¬ì í˜ì´ì§€ (/admin/apps)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¤ íŒŒì¼ ì—…ë¡œë“œ UI                            â”‚  â”‚
â”‚  â”‚ - <input type="file" accept=".html">       â”‚  â”‚
â”‚  â”‚ - ì„±ê³µ ì‹œ publicUrl í‘œì‹œ                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“‹ ì•± ëª©ë¡ + í™œì„±í™” ë²„íŠ¼                    â”‚  â”‚
â”‚  â”‚ - ì—…ë¡œë“œëœ ëª¨ë“  ì•± í‘œì‹œ                     â”‚  â”‚
â”‚  â”‚ - í™œì„± ì•±ì— âœ… í‘œì‹œ                         â”‚  â”‚
â”‚  â”‚ - ë¹„í™œì„± ì•±ì€ í™œì„±í™” ë²„íŠ¼ ì œê³µ             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ìƒì„±ëœ íŒŒì¼

### 1ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤
- **`prisma/schema.prisma`** - `App` ëª¨ë¸ ì¶”ê°€
- **`prisma/migrations/add_app_model/migration.sql`** - ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼

### 2ï¸âƒ£ ë°±ì—”ë“œ API
- **`app/api/admin/upload-html/route.ts`** - íŒŒì¼ ì—…ë¡œë“œ
- **`app/api/apps/current/route.ts`** - í˜„ì¬ í™œì„± ì•± ì¡°íšŒ
- **`app/api/admin/apps/activate/route.ts`** - ì•± í™œì„±í™”
- **`app/api/admin/apps/list/route.ts`** - ì•± ëª©ë¡ ì¡°íšŒ

### 3ï¸âƒ£ í”„ë¡ íŠ¸ì—”ë“œ
- **`app/admin/apps/page.tsx`** - ê´€ë¦¬ì í˜ì´ì§€ (ì—…ë¡œë“œ + ê´€ë¦¬)
- **`components/public/CurrentAppViewer.tsx`** - ë©”ì¸ í˜ì´ì§€ iframe ë Œë”ëŸ¬

### 4ï¸âƒ£ ë©”ì¸ í˜ì´ì§€ ìˆ˜ì •
- **`app/(public)/page.tsx`** - í™œì„±ì•± ê°ì§€ ë° í‘œì‹œ

## ğŸ” ë³´ì•ˆ ì‚¬í•­

### iframe Sandbox ì„¤ì •
```tsx
sandbox="allow-same-origin allow-scripts allow-forms 
         allow-popups allow-presentation allow-modals"
```

**ì œí•œ ì‚¬í•­:**
- âŒ ë¶€ëª¨ í˜ì´ì§€ì˜ ì¿ í‚¤, localStorage ì ‘ê·¼ ë¶ˆê°€
- âŒ ë¶€ëª¨ DOM ì¡°ì‘ ë¶ˆê°€
- âœ… ë‚´ë¶€ JavaScript ì‹¤í–‰ (allow-scripts)
- âœ… í¼ ì œì¶œ (allow-forms)
- âœ… íŒì—… ì—´ê¸° (allow-popups)

### ì¸ì¦ í™•ì¸
ëª¨ë“  ê´€ë¦¬ì APIëŠ” JWT Token ê²€ì¦:
```typescript
const token = authHeader.substring(7);  // Bearer {token}
const decoded = verify(token, JWT_SECRET);
if (decoded.role !== "ADMIN" && decoded.role !== "SUPER_ADMIN") {
  return NextResponse.json({ error: "Admin role required" }, { status: 403 });
}
```

**í† í° ì €ì¥ ìœ„ì¹˜:** `localStorage.getItem('admin_token')`

## ğŸ“Š ë°ì´í„° ìŠ¤í‚¤ë§ˆ

### App ëª¨ë¸
```typescript
model App {
  id          String   @id @default(cuid())        // ê³ ìœ  ID
  name        String                               // íŒŒì¼ëª… (í™•ì¥ì ì œê±°)
  description String?                              // ì„¤ëª…
  htmlContent String                               // ì „ì²´ HTML ë‚´ìš© (CSS+JS í¬í•¨)
  publicPath  String   @unique                     // /apps/{appId}
  isActive    Boolean  @default(false)             // í˜„ì¬ í™œì„±í™” ìƒíƒœ
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

## ğŸš€ ì‚¬ìš© íë¦„

### 1ï¸âƒ£ ê´€ë¦¬ìê°€ ì•± ì—…ë¡œë“œ
```
POST /api/admin/upload-html
Header: Authorization: Bearer {token}
Body: FormData { file: HTMLíŒŒì¼ }

Response:
{
  "appId": "cuid123",
  "publicUrl": "/apps/xyz789",
  "name": "NeuroIQ-Pro-Ultimate-v2"
}
```

### 2ï¸âƒ£ ê´€ë¦¬ìê°€ ì•± í™œì„±í™” (ì„ íƒì )
```
POST /api/admin/apps/activate
Header: Authorization: Bearer {token}
Body: { "appId": "cuid123" }

Response:
{
  "appId": "cuid123",
  "publicUrl": "/apps/xyz789",
  "name": "NeuroIQ-Pro-Ultimate-v2",
  "isActive": true
}
```

### 3ï¸âƒ£ ë©”ì¸ í˜ì´ì§€ ìë™ìœ¼ë¡œ í™œì„± ì•± í‘œì‹œ
```
1. ì„œë²„ì‚¬ì´ë“œ: prisma.app.findFirst({ where: { isActive: true } })
2. htmlContentë¥¼ CurrentAppViewerì— ì „ë‹¬
3. iframeì˜ srcDocì— ë¡œë“œ
4. ì‚¬ìš©ìê°€ ì•± ì‚¬ìš© (ì¿ í‚¤ ì ‘ê·¼ ë¶ˆê°€ - ê²©ë¦¬ë¨)
```

### 4ï¸âƒ£ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜„ì¬ ì•± ì¡°íšŒ ê°€ëŠ¥
```
GET /api/apps/current

Response:
{
  "appId": "cuid123",
  "name": "NeuroIQ-Pro-Ultimate-v2",
  "publicUrl": "/apps/xyz789",
  "htmlContent": "<html>..."
}
```

## ğŸ› ï¸ ì„¤ì¹˜ ë° ë°°í¬

### 1ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
```bash
# .env.local ì„¤ì • í•„ìˆ˜ (DATABASE_URL)
npx prisma migrate deploy

# ë˜ëŠ” ê°œë°œ í™˜ê²½ì—ì„œ
npx prisma migrate dev --name add-app-model
```

### 2ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ ì‹œë“œ (ì´ˆê¸° ê´€ë¦¬ì ìƒì„±)
```bash
npx prisma db seed
```

### 3ï¸âƒ£ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
```bash
npm run dev
```

### 4ï¸âƒ£ ê´€ë¦¬ì ë¡œê·¸ì¸
- URL: `/admin/login`
- ì´ë©”ì¼: `.env.local`ì˜ `ADMIN_EMAIL`
- ë¹„ë°€ë²ˆí˜¸: `.env.local`ì˜ `ADMIN_PASSWORD`

## âš¡ ì„±ëŠ¥ ìµœì í™”

- **htmlContent ì„œë²„ì‚¬ì´ë“œ ì „ë‹¬**: ë©”ì¸ í˜ì´ì§€ì—ì„œ ì§ì ‘ Prismaë¡œ ì¡°íšŒ â†’ í´ë¼ì´ì–¸íŠ¸ API í˜¸ì¶œ ì œê±°
- **ë‹¨ì¼ í™œì„±í™” ì •ì±…**: í™œì„±í™”ëœ ì•±ì€ ìµœëŒ€ 1ê°œ â†’ ê°„ë‹¨í•œ ì¡°íšŒ
- **ì¸ë±ìŠ¤ ì„¤ì •**: `isActive`, `createdAt` ì¸ë±ì‹±

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì—”ë“œí¬ì¸íŠ¸ | ì¸ì¦ | ì„¤ëª… |
|------|-----------|------|------|
| ì•± ì—…ë¡œë“œ | POST /api/admin/upload-html | âœ… | HTML íŒŒì¼ ì €ì¥ |
| ì•± í™œì„±í™” | POST /api/admin/apps/activate | âœ… | ë©”ì¸ì— í‘œì‹œí•  ì•± ì„ íƒ |
| ì•± ëª©ë¡ | GET /api/admin/apps/list | âœ… | ëª¨ë“  ì—…ë¡œë“œ ì•± ì¡°íšŒ |
| í˜„ì¬ ì•± | GET /api/apps/current | âŒ | í™œì„±í™”ëœ ì•± ì¡°íšŒ (ê³µê°œ) |

## ğŸ” íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### iframe ë‚´ JavaScriptê°€ ì‹¤í–‰ ì•ˆ ë¨
- **ì›ì¸**: sandbox ì†ì„±ì—ì„œ `allow-scripts` ëˆ„ë½
- **í•´ê²°**: ì´ë¯¸ í¬í•¨ë¨ âœ…

### ì—…ë¡œë“œëœ ì•±ì´ ë©”ì¸ì— í‘œì‹œ ì•ˆ ë¨
- **ì›ì¸**: ì•±ì´ í™œì„±í™”ë˜ì§€ ì•ŠìŒ (isActive=false)
- **í•´ê²°**: `/admin/apps`ì—ì„œ í™œì„±í™” ë²„íŠ¼ í´ë¦­

### í† í° ê²€ì¦ ì‹¤íŒ¨
- **ì›ì¸**: JWT_SECRET í™˜ê²½ë³€ìˆ˜ ë¯¸ì„¤ì •
- **í•´ê²°**: `.env.local`ì—ì„œ ì„¤ì •í•˜ê±°ë‚˜ ê¸°ë³¸ê°’ ì‚¬ìš© (dev í™˜ê²½)

## ğŸ“ API í…ŒìŠ¤íŠ¸ (ì˜ˆì‹œ)

### curlë¡œ í…ŒìŠ¤íŠ¸
```bash
# 1. ë¡œê·¸ì¸í•˜ì—¬ í† í° ë°›ê¸°
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"..."}'

# 2. íŒŒì¼ ì—…ë¡œë“œ
curl -X POST http://localhost:3000/api/admin/upload-html \
  -H "Authorization: Bearer {token}" \
  -F "file=@NeuroIQ-Pro-Ultimate-v2.html"

# 3. ì•± í™œì„±í™”
curl -X POST http://localhost:3000/api/admin/apps/activate \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"appId":"cuid123"}'

# 4. í˜„ì¬ ì•± ì¡°íšŒ
curl http://localhost:3000/api/apps/current
```

## âœ… ì™„ë£Œëœ ìš”êµ¬ì‚¬í•­ ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ HTML íŒŒì¼ ì—…ë¡œë“œ UI
- âœ… ì—…ë¡œë“œ ì„±ê³µ ì‹œ publicUrl í‘œì‹œ
- âœ… ì„œë²„: POST /api/admin/upload-html (multipart/form-data)
- âœ… ë°˜í™˜ê°’: { appId, publicUrl }
- âœ… ê´€ë¦¬ì í† í°/ì„¸ì…˜ ì¸ì¦
- âœ… iframe sandboxë¡œ ê²©ë¦¬
- âœ… ë©”ì¸ í˜ì´ì§€ì—ì„œ ìµœê·¼ í™œì„± ì•± ìë™ í‘œì‹œ
- âœ… iframe ì‚¬ìš© (srcDoc)
- âœ… sandbox ì˜µì…˜ ì„¤ì •
- âœ… GET /api/apps/current API
- âœ… POST /api/admin/apps/activate API
- âœ… DBì— í˜„ì¬ í™œì„± ì•± ì €ì¥ (isActive)
- âœ… ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì•± ì„ íƒ/í™œì„±í™” ê¸°ëŠ¥

---

**ë§ˆì§€ë§‰ ìˆ˜ì •**: 2026ë…„ 2ì›” 19ì¼
