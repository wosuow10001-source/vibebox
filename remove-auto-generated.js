// ìë™ ìƒì„±ëœ ì½˜í…ì¸  ì œê±° (íƒ€ì„ìŠ¤íƒ¬í”„ê°€ í¬í•¨ëœ ì œëª©)
const fs = require('fs');
const path = require('path');

const filePath = path.join(process.cwd(), 'data', 'contents.json');

try {
  const raw = fs.readFileSync(filePath, 'utf-8');
  const contents = JSON.parse(raw);

  console.log(`ğŸ“Š ì´ ì½˜í…ì¸  ìˆ˜: ${contents.length}`);

  // ìë™ ìƒì„±ëœ ì œëª© íŒ¨í„´: "íƒ€ì… (ë‚ ì§œ ì‹œê°„)"
  const autoGeneratedPattern = /^(ì˜ìƒ|ì´ë¯¸ì§€|HTML ì•±|í”„ë¡œì íŠ¸|ê²Œì„|íŒŒì¼) \(\d{2}\. \d{2}\./;

  const filtered = contents.filter(content => {
    const isAutoGenerated = autoGeneratedPattern.test(content.title);
    if (isAutoGenerated) {
      console.log(`ğŸ—‘ï¸  ìë™ ìƒì„± ì½˜í…ì¸  ì œê±°: ${content.title} (ID: ${content.id})`);
      return false;
    }
    return true;
  });

  console.log(`âœ… í•„í„°ë§ í›„: ${filtered.length}ê°œ`);
  console.log(`ğŸ—‘ï¸  ì œê±°ëœ í•­ëª©: ${contents.length - filtered.length}ê°œ`);

  if (contents.length !== filtered.length) {
    // ë°±ì—… ìƒì„±
    const backupPath = path.join(process.cwd(), 'data', `contents.backup.${Date.now()}.json`);
    fs.writeFileSync(backupPath, raw, 'utf-8');
    console.log(`ğŸ’¾ ë°±ì—… ìƒì„±: ${backupPath}`);

    // í•„í„°ë§ëœ ë°ì´í„° ì €ì¥
    fs.writeFileSync(filePath, JSON.stringify(filtered, null, 2), 'utf-8');
    console.log(`âœ… ì €ì¥ ì™„ë£Œ: ${filePath}`);
  } else {
    console.log(`â„¹ï¸  ì œê±°í•  ìë™ ìƒì„± ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.`);
  }

} catch (error) {
  console.error('âŒ ì˜¤ë¥˜:', error);
  process.exit(1);
}
